<div
  class="featured {% if product.images.size == 1 %}full-width{% endif %}"
  id="ProductPhoto-{{ section.id }}"
  data-ProductPhoto
>
  <div
    class="product-image--slider"
    id="ProductImageSlider-{{ section.id }}"
    data-zoom="{{ section.settings.product_featured_zoom_enable }}"
    data-lightbox="{{ section.settings.product_featured_lightbox_enable }}"
    data-show-arrows="{{ section.settings.show_arrows }}"
    data-slider-enabled="{{ section.settings.enable_image_slider }}"
    data-flickity-options='
      {
        "adaptiveHeight": true,
        "imagesLoaded": true,
        "lazyLoad": false,
        "wrapAround": true,
        "fullscreen": true,
        {% if product.images.size == 1 %}
        "pageDots": false,
        {% else %}
        "pageDots": {{ section.settings.show_dots }},
        {% endif %}
        "prevNextButtons": false,
        "selectedAttraction": 0.15,
        "friction": 0.8
      }
    '
    data-ProductImageSlider
    aria-label="Product Images"
    role="listbox"
  >
    {%- for image in product.images -%}
      {%- assign image_width = image.width | append: 'x' -%}
      {%- assign image_highresolution = image | img_url: image_width -%}
      {%- assign active_image = current_variant.featured_image | default: product.featured_image -%}
      <div
        class="product-image--cell"
        data-image-id="{{ image.id }}"
        {% if image == active_image %}
          data-initial-image
        {% endif %}
      >
        <div id="ProductImageCellContainer-{{ image.id }}">
          <a
            href="{{ image_highresolution }}"
            id="CardImageContainer-{{ image.id }}"
            class="card__image-container"
            target="_blank"
            aria-label="Product Image #{{ image.position }}"
            role="option"
          >
            <div
              id="ProductImage-{{ section.id-}}-{{ image.id }}"
              data-id="{{ image.id }}"
              data-section-id="{{ section.id }}"
              data-widths="[{{ image_widths }}]"
              data-position="{{ image.position | minus: 1 }}"
            >
              {% assign loading = 'lazy' %}
              {%- if image == active_image or forloop.index0 == 0 -%}
                {% assign loading = 'eager' %}
              {% endif %}

              {{
                image
                | image_url: width: 2100
                | image_tag:
                  widths: '350, 700, 1050, 1400, 2100',
                  sizes: '(min-width: 780px) 400px, 350px',
                  loading: loading
              }}
            </div>
            {% assign height = image.height | plus: 0 %}
            {% assign width = image.width | plus: 0 %}
            {% assign padding_ratio = height | times: 100 | divided_by: width %}
            <style>
                .product-image--slider:not(.is-fullscreen) #ProductImageCellContainer-{{ image.id }} {
                  width: 100%;
                  max-width: {{ width }}px;
                }
                .product-image--slider:not(.is-fullscreen) #CardImageContainer-{{ image.id }} {
                  position: relative;
                  height: 0;
                  padding-bottom: {{ padding_ratio }}%;
                }
                @media screen and (max-width:768px) {
                .product-image--slider:not(.is-fullscreen) #CardImageContainer-{{ image.id }} img {
                  width: 100%;
                  height: auto;
                  position: absolute;
                  top: 0;
                  left: 0;
                }
                .product-image--cell {
                  height: auto;
                }
              }
              @media screen and (min-width:769px) {
                .product-image--slider:not(.is-fullscreen) #CardImageContainer-{{ image.id }} img {
                  width: 100%;
                  height: 100%;
                  position: absolute;
                  top: 0;
                  left: 0;
                }
              }
                .product-image--slider.is-fullscreen #CardImageContainer-{{ image.id }} img {
                  height: {{ height }}px;
                  width: {{ width }}px;
                }
            </style>
          </a>
        </div>
      </div>
    {%- endfor -%}
  </div>
</div>
